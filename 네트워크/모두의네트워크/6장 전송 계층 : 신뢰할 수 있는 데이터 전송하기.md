# 23 전송 계층의 역할

물리 계층, 데이터 링크 계층, 네트워크 계층의 3계층이 있으면 목적지에 데이터를 보낼 수 있지만 데이터가 손상되거나 유실되더라도 이 계층들에서는 아무것도 해주지 않는다. **전송 계층**은 **목적지에 신뢰할 수 있는 데이터를 전달**하기 위해 필요하다.

### 전송 계층 기능

전송 계층에는 **오류를 점검하는 기능**이 있어서 오류가 발생하면 데이터를 재전송하도록 요청한다. 또한 **전송된 데이터의 목적지가 어떤 애플리케이션인지 식별**하는 기능이 있다.

### 특징

- **신뢰성/정확성 :** 데이터를 목적지에 문제없이 전달하는 것
- **효율성 :** 데이터를 빠르고 효율적으로 전달하는 것

- **연결형 통신**

    신뢰할 수 있고 정확하게 데이터를 전송

    통신 프로토콜로 **TCP**가 사용된다.

- **비연결형 통신**

    신뢰성을 보장하진 않지만 효율적으로 빨리 데이터를 전송 ex) 동영상

    통신 프로토콜로 **UDP**가 사용된다.

# 24 TCP의 구조

TCP는 연결형 통신에 사용되는 프로토콜이다.

### TCP 헤더

![https://user-images.githubusercontent.com/57691894/130984576-064d367c-f877-45c4-a16c-95b70387bea5.png](https://user-images.githubusercontent.com/57691894/130984576-064d367c-f877-45c4-a16c-95b70387bea5.png)

### 연결(connection)

TCP 통신에서 정보를 전달하기 위해 사용되는 **가상의 독점 통신로**로 연결을 확립하고 데이터를 전송한다.

**코드비트**

코드비트에는 연결의 제어 정보가 기록된다. 각 비트별로 역할이 있다. 초기값은 0이고, 비트가 활성화되면 1이 된다. 연결을 확림하려면 SYN과 ACK가 필요하다.

- **SYN : 연결요청**
- **ACK : 확인응답**

|URG|ACK|PSH|RST|SYN|FIN|
|---|---|---|---|---|---|
|0|0|0|0|0|0|

### 3-way 핸드셰이크

신뢰할 수 있는 연결을 하려면 데이터를 전송하기 전에 패킷을 교환하는데, 세 번 확인한다.

1. **연결 확립 요청** : 컴퓨터B의 허가를 받기 위해 컴퓨터A에서 컴퓨터B로 **SYN**을 보낸다.

    |URG|ACK|PSH|RST|***SYN***|FIN|
    |---|---|---|---|---|---|
    |0|0|0|0|***1***|0|

2. **연결 확립 응답 + 연결 확립 요청** : 컴퓨터B는 요청을 허가한다는 응답을 회신하기 위해 **ACK**를 보낸다. 동시에 컴퓨터B도 컴퓨터A에게 데이터 전송 허가를 받기 위해 **SYN**을 보낸다.

    |URG|***ACK***|PSH|RST|***SYN***|FIN|
    |---|---|---|---|---|---|
    |0|***1***|0|0|***1***|0|

3. **연결 확립 응답** : 컴퓨터B의 요청을 받은 컴퓨터A는 허가한다는 응답으로 **ACK**을 보낸다.

    |URG|***ACK***|PSH|RST|SYN|FIN|
    |---|---|---|---|---|---|
    |0|***1***|0|0|0|0|

데이터를 전송한 후에는 연결을 끊기 위한 요청을 교환해야 한다. 이때 FIN과 ACK를 사용한다.

- **FIN : 연결 종료**
1. 연결 종료 요청 : 컴퓨터A에서 컴퓨터B로 FIN을 보낸다.

    |URG|ACK|PSH|RST|SYN|***FIN***|
    |---|---|---|---|---|---|
    |0|0|0|0|0|***1***|

2. 연결 종료 응답 : 컴퓨터B에서 컴퓨터A로 ACK를 반환한다.

    |URG|***ACK***|PSH|RST|SYN|FIN|
    |---|---|---|---|---|---|
    |0|***1***|0|0|0|0|

3. 연결 종료 요청 : 컴퓨터B에서 컴퓨터A로 FIN을 보낸다.

    |URG|ACK|PSH|RST|SYN|***FIN***|
    |---|---|---|---|---|---|
    |0|0|0|0|0|***1***|

4. 연결 종료 응답 : 컴퓨터A에서 컴퓨터B로 ACK를 반환한다.

    |URG|***ACK***|PSH|RST|SYN|FIN|
    |---|---|---|---|---|---|
    |0|***1***|0|0|0|0|
